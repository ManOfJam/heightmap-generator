<!DOCTYPE html>
<html lang="en-gb">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Heightmap Generator</title>
		<link rel="stylesheet" type="text/css" href="style/app.css">
	</head>
	<body>
		<div id="controls">
			<div>
				<label for="seed">Seed</label>
				<input type="number" id="seed">
				<div class="button-wrap">
					<button id="new">New</button>
				</div>
			</div>
			<div>
				<label for="size">Size</label>
				<select id="size"></select>
				<div class="button-wrap">
					<button id="next">Next</button>
				</div>
			</div>
			<div>
				<label for="roughness">Roughness</label>
				<input type="number" id="roughness" value="0.5" min="0" step="0.1">
			</div>
			<div>
				<label for="tile-size">Tile Size</label>
				<input type="number" id="tile-size" value="4" min="0">
			</div>
			<div class="button-wrap">
				<button id="generate">Generate</button>
			</div>
		</div>
		<canvas id="heightmap"></canvas>
		<script src="script/heightmap.js"></script>
		<script>
			const seedInput = document.getElementById("seed");
			const newButton = document.getElementById("new");
			const sizeInput = document.getElementById("size");
			const nextButton = document.getElementById("next");
			const roughnessInput = document.getElementById("roughness");
			const tileSizeInput = document.getElementById("tile-size");
			const generateButton = document.getElementById("generate");

			const newSeed = function() {
				seedInput.value = Math.random().toString().substring(2);
			};

			const powersOfTwo = (function* () {
				let n = 1;
				while(true)
					yield n*=2;
			})();

			const addSize = function() {
				const value = powersOfTwo.next().value;
				sizeInput.appendChild(new Option(value + 1, Math.log2(value)));
			};

			const generate = function() {
				Heightmap.draw("heightmap", Heightmap.create(sizeInput.value, roughnessInput.value, seedInput.value), tileSizeInput.value);
			};

			let i = 10;
			while(i--)
				addSize();

			nextButton.addEventListener("click", addSize);
			newButton.addEventListener("click", newSeed);
			generateButton.addEventListener("click", generate);

			sizeInput.childNodes[6].setAttribute("selected", true);

			newSeed();
			generate();
		</script>
	</body>
</html>